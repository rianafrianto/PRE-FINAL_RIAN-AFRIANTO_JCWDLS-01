{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Riana\\\\OneDrive\\\\Desktop\\\\Mini Project\\\\facebook\\\\frontend\\\\src\\\\components\\\\profielPicture\\\\UpdateProfilePicture.js\",\n    _s = $RefreshSig$();\n\nimport axios from \"axios\";\nimport { useCallback, useRef, useState } from \"react\";\nimport Cropper from \"react-easy-crop\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { createPost } from \"../../functions/post\";\nimport { uploadImages } from \"../../functions/uploadImages\";\nimport { updateprofilePicture } from \"../../functions/user\";\nimport getCroppedImg from \"../../helpers/getCroppedImg\";\nimport PulseLoader from \"react-spinners/PulseLoader\";\nimport Cookies from \"js-cookie\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function UpdateProfilePicture(_ref) {\n  _s();\n\n  let {\n    setImage,\n    image,\n    setError,\n    setShow,\n    pRef\n  } = _ref;\n  const dispatch = useDispatch();\n  const [description, setDescription] = useState(\"\");\n  const [crop, setCrop] = useState({\n    x: 0,\n    y: 0\n  });\n  const [zoom, setZoom] = useState(1);\n  const [croppedAreaPixels, setCroppedAreaPixels] = useState(null);\n  const slider = useRef(null);\n  const {\n    user\n  } = useSelector(state => ({ ...state\n  }));\n  const [loading, setLoading] = useState(false);\n  const onCropComplete = useCallback((croppedArea, croppedAreaPixels) => {\n    setCroppedAreaPixels(croppedAreaPixels);\n  }, []);\n\n  const zoomIn = () => {\n    slider.current.stepUp();\n    setZoom(slider.current.value);\n  };\n\n  const zoomOut = () => {\n    slider.current.stepDown();\n    setZoom(slider.current.value);\n  };\n\n  const getCroppedImage = useCallback(async show => {\n    try {\n      const img = await getCroppedImg(image, croppedAreaPixels);\n\n      if (show) {\n        setZoom(1);\n        setCrop({\n          x: 0,\n          y: 0\n        });\n        setImage(img);\n      } else {\n        return img;\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  }, [croppedAreaPixels]);\n\n  const updateProfielPicture = async () => {\n    try {\n      setLoading(true);\n      let img = await getCroppedImage();\n      let blob = await fetch(img).then(b => b.blob());\n      const path = `${user.username}/profile_pictures`;\n      let formData = new FormData();\n      formData.append(\"file\", blob);\n      formData.append(\"path\", path);\n      const res = await uploadImages(formData, path, user.token);\n      const updated_picture = await updateprofilePicture(res[0].url, user.token);\n\n      if (updated_picture === \"ok\") {\n        const new_post = await createPost(\"profilePicture\", null, description, res, user.id, user.token);\n\n        if (new_post.status === \"ok\") {\n          setLoading(false);\n          setImage(\"\");\n          pRef.current.style.backgroundImage = `url(${res[0].url})`;\n          Cookies.set(\"user\", JSON.stringify({ ...user,\n            picture: res[0].url\n          }));\n          dispatch({\n            type: \"UPDATEPICTURE\",\n            payload: res[0].url\n          });\n          setShow(false);\n        } else {\n          setLoading(false);\n          setError(new_post);\n        }\n      } else {\n        setLoading(false);\n        setError(updated_picture);\n      }\n    } catch (error) {\n      setLoading(false);\n      setError(error.response.data.message);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"postBox update_img\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"box_header\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"small_circle\",\n        onClick: () => setImage(\"\"),\n        children: /*#__PURE__*/_jsxDEV(\"i\", {\n          className: \"exit_icon\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        children: \"Update profile picture\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"update_image_desc\",\n      children: /*#__PURE__*/_jsxDEV(\"textarea\", {\n        placeholder: \"Description\",\n        value: description,\n        onChange: e => setDescription(e.target.value),\n        className: \"textarea_blue details_input\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"update_center\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"crooper\",\n        children: /*#__PURE__*/_jsxDEV(Cropper, {\n          image: image,\n          crop: crop,\n          zoom: zoom,\n          aspect: 1 / 1,\n          cropShape: \"round\",\n          onCropChange: setCrop,\n          onCropComplete: onCropComplete,\n          onZoomChange: setZoom,\n          showGrid: false\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 127,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"slider\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"slider_circle hover1\",\n          onClick: () => zoomOut(),\n          children: /*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"minus_icon\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 141,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 140,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"range\",\n          min: 1,\n          max: 3,\n          step: 0.2,\n          ref: slider,\n          value: zoom,\n          onChange: e => setZoom(e.target.value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 143,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"slider_circle hover1\",\n          onClick: () => zoomIn(),\n          children: /*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"plus_icon\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 153,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex_up\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"gray_btn\",\n        onClick: () => getCroppedImage(\"show\"),\n        children: [/*#__PURE__*/_jsxDEV(\"i\", {\n          className: \"crop_icon\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 159,\n          columnNumber: 11\n        }, this), \"Crop photo\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"gray_btn\",\n        children: [/*#__PURE__*/_jsxDEV(\"i\", {\n          className: \"temp_icon\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 162,\n          columnNumber: 11\n        }, this), \"Make Temporary\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex_p_t\",\n      children: [/*#__PURE__*/_jsxDEV(\"i\", {\n        className: \"public_icon\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 9\n      }, this), \"Your profile picture is public\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"update_submit_wrap\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"blue_link\",\n        onClick: () => setImage(\"\"),\n        children: \"Cancel\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"blue_btn\",\n        disabled: loading,\n        onClick: () => updateProfielPicture(),\n        children: loading ? /*#__PURE__*/_jsxDEV(PulseLoader, {\n          color: \"#fff\",\n          size: 5\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 22\n        }, this) : \"Save\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 109,\n    columnNumber: 5\n  }, this);\n}\n\n_s(UpdateProfilePicture, \"G+2KPmyH6RIXLOW/pyxRVvnLbU8=\", false, function () {\n  return [useDispatch, useSelector];\n});\n\n_c = UpdateProfilePicture;\n\nvar _c;\n\n$RefreshReg$(_c, \"UpdateProfilePicture\");","map":{"version":3,"sources":["C:/Users/Riana/OneDrive/Desktop/Mini Project/facebook/frontend/src/components/profielPicture/UpdateProfilePicture.js"],"names":["axios","useCallback","useRef","useState","Cropper","useDispatch","useSelector","createPost","uploadImages","updateprofilePicture","getCroppedImg","PulseLoader","Cookies","UpdateProfilePicture","setImage","image","setError","setShow","pRef","dispatch","description","setDescription","crop","setCrop","x","y","zoom","setZoom","croppedAreaPixels","setCroppedAreaPixels","slider","user","state","loading","setLoading","onCropComplete","croppedArea","zoomIn","current","stepUp","value","zoomOut","stepDown","getCroppedImage","show","img","error","console","log","updateProfielPicture","blob","fetch","then","b","path","username","formData","FormData","append","res","token","updated_picture","url","new_post","id","status","style","backgroundImage","set","JSON","stringify","picture","type","payload","response","data","message","e","target"],"mappings":"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","sourcesContent":["import axios from \"axios\";\r\nimport { useCallback, useRef, useState } from \"react\";\r\nimport Cropper from \"react-easy-crop\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { createPost } from \"../../functions/post\";\r\nimport { uploadImages } from \"../../functions/uploadImages\";\r\nimport { updateprofilePicture } from \"../../functions/user\";\r\nimport getCroppedImg from \"../../helpers/getCroppedImg\";\r\nimport PulseLoader from \"react-spinners/PulseLoader\";\r\nimport Cookies from \"js-cookie\";\r\nexport default function UpdateProfilePicture({\r\n  setImage,\r\n  image,\r\n  setError,\r\n  setShow,\r\n  pRef,\r\n}) {\r\n  const dispatch = useDispatch();\r\n  const [description, setDescription] = useState(\"\");\r\n  const [crop, setCrop] = useState({ x: 0, y: 0 });\r\n  const [zoom, setZoom] = useState(1);\r\n  const [croppedAreaPixels, setCroppedAreaPixels] = useState(null);\r\n  const slider = useRef(null);\r\n  const { user } = useSelector((state) => ({ ...state }));\r\n  const [loading, setLoading] = useState(false);\r\n  const onCropComplete = useCallback((croppedArea, croppedAreaPixels) => {\r\n    setCroppedAreaPixels(croppedAreaPixels);\r\n  }, []);\r\n  const zoomIn = () => {\r\n    slider.current.stepUp();\r\n    setZoom(slider.current.value);\r\n  };\r\n  const zoomOut = () => {\r\n    slider.current.stepDown();\r\n    setZoom(slider.current.value);\r\n  };\r\n  const getCroppedImage = useCallback(\r\n    async (show) => {\r\n      try {\r\n        const img = await getCroppedImg(image, croppedAreaPixels);\r\n        if (show) {\r\n          setZoom(1);\r\n          setCrop({ x: 0, y: 0 });\r\n          setImage(img);\r\n        } else {\r\n          return img;\r\n        }\r\n      } catch (error) {\r\n        console.log(error);\r\n      }\r\n    },\r\n    [croppedAreaPixels]\r\n  );\r\n  const updateProfielPicture = async () => {\r\n    try {\r\n      setLoading(true);\r\n      let img = await getCroppedImage();\r\n      let blob = await fetch(img).then((b) => b.blob());\r\n      const path = `${user.username}/profile_pictures`;\r\n      let formData = new FormData();\r\n      formData.append(\"file\", blob);\r\n      formData.append(\"path\", path);\r\n      const res = await uploadImages(formData, path, user.token);\r\n      const updated_picture = await updateprofilePicture(\r\n        res[0].url,\r\n        user.token\r\n      );\r\n      if (updated_picture === \"ok\") {\r\n        const new_post = await createPost(\r\n          \"profilePicture\",\r\n          null,\r\n          description,\r\n          res,\r\n          user.id,\r\n          user.token\r\n        );\r\n        if (new_post.status === \"ok\") {\r\n          setLoading(false);\r\n          setImage(\"\");\r\n          pRef.current.style.backgroundImage = `url(${res[0].url})`;\r\n          Cookies.set(\r\n            \"user\",\r\n            JSON.stringify({\r\n              ...user,\r\n              picture: res[0].url,\r\n            })\r\n          );\r\n          dispatch({\r\n            type: \"UPDATEPICTURE\",\r\n            payload: res[0].url,\r\n          });\r\n          setShow(false);\r\n        } else {\r\n          setLoading(false);\r\n\r\n          setError(new_post);\r\n        }\r\n      } else {\r\n        setLoading(false);\r\n\r\n        setError(updated_picture);\r\n      }\r\n    } catch (error) {\r\n      setLoading(false);\r\n      setError(error.response.data.message);\r\n    }\r\n  };\r\n  return (\r\n    <div className=\"postBox update_img\">\r\n      <div className=\"box_header\">\r\n        <div className=\"small_circle\" onClick={() => setImage(\"\")}>\r\n          <i className=\"exit_icon\"></i>\r\n        </div>\r\n        <span>Update profile picture</span>\r\n      </div>\r\n      <div className=\"update_image_desc\">\r\n        <textarea\r\n          placeholder=\"Description\"\r\n          value={description}\r\n          onChange={(e) => setDescription(e.target.value)}\r\n          className=\"textarea_blue details_input\"\r\n        ></textarea>\r\n      </div>\r\n\r\n      <div className=\"update_center\">\r\n        <div className=\"crooper\">\r\n          <Cropper\r\n            image={image}\r\n            crop={crop}\r\n            zoom={zoom}\r\n            aspect={1 / 1}\r\n            cropShape=\"round\"\r\n            onCropChange={setCrop}\r\n            onCropComplete={onCropComplete}\r\n            onZoomChange={setZoom}\r\n            showGrid={false}\r\n          />\r\n        </div>\r\n        <div className=\"slider\">\r\n          <div className=\"slider_circle hover1\" onClick={() => zoomOut()}>\r\n            <i className=\"minus_icon\"></i>\r\n          </div>\r\n          <input\r\n            type=\"range\"\r\n            min={1}\r\n            max={3}\r\n            step={0.2}\r\n            ref={slider}\r\n            value={zoom}\r\n            onChange={(e) => setZoom(e.target.value)}\r\n          />\r\n          <div className=\"slider_circle hover1\" onClick={() => zoomIn()}>\r\n            <i className=\"plus_icon\"></i>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div className=\"flex_up\">\r\n        <div className=\"gray_btn\" onClick={() => getCroppedImage(\"show\")}>\r\n          <i className=\"crop_icon\"></i>Crop photo\r\n        </div>\r\n        <div className=\"gray_btn\">\r\n          <i className=\"temp_icon\"></i>Make Temporary\r\n        </div>\r\n      </div>\r\n      <div className=\"flex_p_t\">\r\n        <i className=\"public_icon\"></i>\r\n        Your profile picture is public\r\n      </div>\r\n      <div className=\"update_submit_wrap\">\r\n        <div className=\"blue_link\" onClick={() => setImage(\"\")}>\r\n          Cancel\r\n        </div>\r\n        <button\r\n          className=\"blue_btn\"\r\n          disabled={loading}\r\n          onClick={() => updateProfielPicture()}\r\n        >\r\n          {loading ? <PulseLoader color=\"#fff\" size={5} /> : \"Save\"}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}